{% extends 'base_user.html' %}
{% block title %}My Chats{% endblock %}

{% block content %}
<style>
  .chat-wrapper {
      max-width: 900px;
      margin: auto;
  }

  .chat-card {
      background: #ffffff;
      border-radius: 18px;
      padding: 24px;
      box-shadow: 0 10px 28px rgba(0,0,0,0.08);
  }

  .chat-item {
      border: none;
      border-radius: 14px;
      padding: 18px 20px;
      margin-bottom: 14px;
      background: #f8fafc;
      transition: all 0.25s ease;
  }

  .chat-item:hover {
      background: #ffffff;
      transform: translateY(-2px);
      box-shadow: 0 6px 18px rgba(0,0,0,0.12);
  }

  .chat-avatar {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: linear-gradient(135deg, #4f46e5, #2563eb);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      color: #ffffff;
      margin-right: 15px;
      font-size: 1rem;
  }

  .chat-name {
      font-weight: 600;
      color: #1e293b;
  }

  .chat-preview {
      font-size: 0.9rem;
      color: #64748b;
  }

  .unread-badge {
      background: linear-gradient(135deg, #2563eb, #1e40af);
      font-size: 0.75rem;
      padding: 6px 10px;
      border-radius: 999px;
      color: #ffffff;
      font-weight: 600;
  }

  .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #64748b;
  }

  .empty-state i {
      font-size: 3rem;
      color: #94a3b8;
      margin-bottom: 15px;
  }
</style>

<div class="container py-5">
    <div class="chat-wrapper">
        <div class="chat-card">
            <h3 class="fw-bold mb-4 text-primary">
                ðŸ’¬ My Chats
            </h3>

            {% if chat_data %}
                <div class="list-group list-group-flush">
                    {% for item in chat_data %}
                        <a href="{% url 'chat_room' item.chat.id %}"
                           class="list-group-item chat-item d-flex justify-content-between align-items-center">

                            <div class="d-flex align-items-center">
                                <!-- Avatar -->
                                <div class="chat-avatar">
                                    {% for user in item.other_participants %}
                                        {% if forloop.first %}
                                            {{ user.username|slice:":1"|upper }}
                                        {% endif %}
                                    {% endfor %}
                                </div>


                                <!-- Chat info -->
                                <div>
                                    <div class="chat-name">
                                        {% for user in item.other_participants %}
                                            {{ user.username }}{% if not forloop.last %}, {% endif %}
                                        {% endfor %}
                                    </div>

                                    {% if item.last %}
                                        <div class="chat-preview">
                                            {{ item.last.sender.username }}:
                                            {{ item.last.message|truncatechars:45 }}
                                        </div>
                                    {% else %}
                                        <div class="chat-preview">
                                            No messages yet
                                        </div>
                                    {% endif %}
                                </div>
                            </div>

                            {% if item.unread > 0 %}
                                <span class="unread-badge">
                                    {{ item.unread }}
                                </span>
                            {% endif %}
                        </a>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state">
                    <i class="fa-solid fa-comments"></i>
                    <h5>No chats yet</h5>
                    <p>
                        Start a conversation by clicking
                        <strong>Chat</strong> on a room listing or user profile.
                    </p>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
