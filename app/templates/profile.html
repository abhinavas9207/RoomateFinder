{% extends 'base_user.html' %}
{% load static %}

{% block title %}User Profile{% endblock %}
{% block titlebar %}My Profile{% endblock %}

{% block content %}
<div class="profile-container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-8">

      {% if not created %}
      <!-- âœ… Profile Exists -->
      <div class="profile-card glass-card p-4 p-md-5 animate-fade">

        <!-- =======================
             PROFILE IMAGE + TEXT FIXED
        ======================== -->
        <div class="profile-header mb-4 border-bottom pb-3">
          <div class="profile-avatar-wrapper">
            {% if form.instance.profile_image %}
              <img src="{{ form.instance.profile_image.url }}" 
                   alt="Profile Image"
                   class="profile-avatar rounded-circle border border-3 border-light shadow-lg">
            {% else %}
              <img src="{% static 'images/default-user.png' %}" 
                   alt="Default Image"
                   class="profile-avatar rounded-circle border border-3 border-light shadow-lg">
            {% endif %}
          </div>

          <div class="profile-info">
            <h3 class="fw-bold mb-1 text-capitalize text-white">
              {{ form.instance.name|default:request.user.username }}
            </h3>
            <p class="text-light mb-0">
              {{ form.instance.email|default:"No email available" }}
            </p>
          </div>
        </div>
        <!-- ===================================== -->

        <form method="POST" enctype="multipart/form-data" class="row g-3 text-dark">
          {% csrf_token %}
          
          {% for field in form %}
            {% if field.name == 'bio' or field.name == 'location' %}
              <div class="col-12 field-container">
                <label class="form-label fw-semibold text-light">{{ field.label }}</label>
                {{ field }}
                {% if field.errors %}
                  <div class="text-danger small">{{ field.errors|join:", " }}</div>
                {% endif %}
              </div>
            {% else %}
              <div class="col-md-6 field-container">
                <label class="form-label fw-semibold text-light">{{ field.label }}</label>
                {{ field }}
                {% if field.errors %}
                  <div class="text-danger small">{{ field.errors|join:", " }}</div>
                {% endif %}
              </div>
            {% endif %}
          {% endfor %}

          <div class="col-12 text-end mt-3">
            <button type="submit" class="btn btn-gradient px-4 py-2 rounded-pill fw-semibold">
              <i class="fa-solid fa-floppy-disk me-2"></i> Save Changes
            </button>
          </div>
        </form>
      </div>

      {% else %}
      <!-- âŒ No Profile Found -->
      <div class="glass-card text-center p-5 animate-fade">
        <img src="{% static 'images/default-user.png' %}" width="130" class="mb-4 rounded-circle border border-3 border-light shadow-sm">
        <h4 class="fw-bold text-white mb-2">No Profile Found</h4>
        <p class="text-light mb-4">You havenâ€™t created your profile yet. Letâ€™s set it up!</p>
        <form method="POST" enctype="multipart/form-data">
          {% csrf_token %}
          <button type="submit" class="btn btn-gradient px-4 py-2 rounded-pill fw-semibold">
            <i class="fa-solid fa-plus-circle me-2"></i> Create Profile
          </button>
        </form>
      </div>
      {% endif %}
    </div>
  </div>
</div>

<style>
/* ðŸŒˆ Background */
.profile-container {
  min-height: 100vh;
  background: linear-gradient(135deg, #667eea, #764ba2);
  display: flex;
  align-items: center;
  justify-content: center;
  background-attachment: fixed;
  font-family: "Poppins", sans-serif;
}

/* ðŸ’Ž Glass Card */
.glass-card {
  background: rgba(255, 255, 255, 0.15);
  backdrop-filter: blur(15px);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(31, 38, 135, 0.2);
  border: 1px solid rgba(255, 255, 255, 0.2);
}

/* ===============================
   PROFILE HEADER ALIGNMENT FIX
================================ */
.profile-header {
  display: flex;
  align-items: center;
  gap: 1.5rem;
}

.profile-avatar-wrapper {
  flex: 0 0 110px;
  display: flex;
  justify-content: center;
  align-items: center;
}

.profile-avatar {
  width: 110px;
  height: 110px;
  object-fit: cover;
  border-radius: 50%;
  display: block;
}

.profile-info {
  display: flex;
  flex-direction: column;
  justify-content: center;
  min-width: 0;
}

@media (max-width: 576px) {
  .profile-header {
    flex-direction: column;
    text-align: center;
  }
}

/* ===============================
   FORM FIELD FIX
================================ */
.field-container {
  display: flex;
  flex-direction: column;
}

.profile-card form input,
.profile-card form select,
.profile-card form textarea,
.profile-card form .form-control {
  width: 100% !important;
  border-radius: 12px !important;
  border: none;
  background: rgba(255, 255, 255, 0.85);
  box-shadow: 0 0 5px rgba(255,255,255,0.2);
  transition: all 0.3s ease;
}

.profile-card form input:focus,
.profile-card form select:focus,
.profile-card form textarea:focus {
  box-shadow: 0 0 0 0.15rem rgba(79, 70, 229, 0.35);
  transform: translateY(-2px);
}

/* ðŸŽ¨ Button */
.btn-gradient {
  background: linear-gradient(90deg, #6a5acd, #8a2be2);
  color: #fff;
  transition: all 0.3s ease;
}
.btn-gradient:hover {
  background: linear-gradient(90deg, #8a2be2, #6a5acd);
  box-shadow: 0 4px 12px rgba(138, 43, 226, 0.4);
}

/* Animation */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}
.animate-fade { animation: fadeIn 0.6s ease-in-out; }

.text-light {
  color: rgba(255,255,255,0.85) !important;
}
</style>

{% endblock %}
